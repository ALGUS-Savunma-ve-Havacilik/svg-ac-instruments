<!doctype html>
<html>
<head>
  <style>/* this styling works on Chrome */
  html,body {
      overflow:hidden; /* no scrollbars, they make the resizing more complicated */
  }
  .container {
    display: flex;
    flex-direction:column;
    background-color: #000;
  }
  .row {
    display:flex;
    flex-direction:row;
    justify-content: center;
  }
  </style>
</head>
<body>

<div class='container'>
  <div class='row'>
    <div>  <!-- @include airspeed.svg -->  </div>
    <div>  <!-- @include attitude.svg -->  </div>
    <div>  <!-- @include altimeter.svg --> </div>
  </div>
  <div class='row'>
    <div>  <!-- @include turn.svg -->    </div>
    <div>  <!-- @include heading.svg --> </div>
    <div>  <!-- @include vsi.svg -->     </div>
  </div>
</div>
<script src="/svg-ac-inst.js"></script>
<script>

<!-- instantiate the heading indicator, give it the name that matches the template -->
var heading = svg_ac_inst.Heading(document.querySelector("#heading"),"gg145-heading",false);
var degrees = 0;

<!-- instantiate the altimeter, give it the name that matches the template -->
var altimeter = svg_ac_inst.Altimeter(document.querySelector("#altimeter"),"gg145-altimeter",false);
var altitude=0.0;
var pressure = 29.92;
altimeter.setPressure(pressure);

<!-- instantiate the airspeed indicator, give it the name that matches the template -->
var airspeed = svg_ac_inst.Airspeed(document.querySelector("#airspeed"),"gg145-airspeed",false);
var speed = 0;

<!-- instantiate the VSI, give it the name that matches the template -->
var vsi = svg_ac_inst.VSI(document.querySelector("#vsi"),"gg145-vsi",false);
var vspeed = -2000;

<!-- instantiate the attitude indicator, give it the name that matches the template -->
var attitude = svg_ac_inst.Attitude(document.querySelector('#attitude'),"gg145-attitude",false);

<!-- instantiate the turn coordinator, give it the name that matches the template -->
var turn = svg_ac_inst.Turn(document.querySelector('#turn'),"gg145-turn",false);
var turn_rate=-3.0;
var db=0.1;
var accel = 0.0;
var da    = 0.2;
var pitch = 0.0;
var roll  = 0.0;
var dr    = 0.2;
var dp    = 0.1;

// simple resize that uses window size minus some border
function panel_onResize() {
    var cw = window.innerWidth  - 20;
    var ch = window.innerHeight - 20;
    var w = cw  / 3;
    var h = ch / 2;
    // use smaller of h and w so all 6 instruments will fit on the screen
    var s = (h < w) ? h : w;
    console.log(cw,ch,w,h,s);
    heading.resize(s);
    altimeter.resize(s);
    airspeed.resize(s);
    vsi.resize(s);
    attitude.resize(s);
    turn.resize(s);
}

function panel_onReady() {
    panel_onResize();
}

function run(timestamp) {
    heading.set(degrees);
    airspeed.set(speed);
    altimeter.set(altitude);
    vsi.set(vspeed);
    turn.set(turn_rate,accel);
    attitude.set(pitch,roll);

    vspeed+=1.0;
    if (vspeed >= 2000) {
      vspeed = -2000;
    }

    turn_rate += db;
    if (Math.abs(turn_rate) >= 3.0) {
      db *= -1.0;
    }
    accel += da;
    if (Math.abs(accel) >= 12.0) {
      da *= -1.0;
    }

    roll += dr;
    if (Math.abs(roll) >= 45.0) {
        dr *= -1;
    }
    pitch += dp;
    if (Math.abs(pitch) >= 45) {
        dp *= -1;
    }

    degrees+=1.0;
    altitude+=1.0;
    speed+= 1.0;
    if (speed > 220.0) speed = 0;

    requestAnimationFrame(run);
  }

// add event listeners
window.addEventListener('resize',panel_onResize);
window.addEventListener('load',panel_onReady);

// start gauges running
requestAnimationFrame(run);

</script>
</body>
</html>
