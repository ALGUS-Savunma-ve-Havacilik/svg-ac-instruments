<!doctype html>
<html>
<head>
  <style>/* this styling works on Chrome */
  html,body {
      overflow:hidden; /* no scrollbars, they make the resizing more complicated */
  }
  .container {
    display: flex;
    flex-direction:column;
    background-color: #000;
  }
  .row {
    display:flex;
    flex-direction:row;
    justify-content: center;
  }
  </style>
</head>
<body>

<div class='container'>
  <div class='row'>
    <div id='svg-airspeed'>
   </div>
    <div id='svg-attitude'>
    </div>
    <div id='svg-altimeter'>
    </div>
  </div>
  <div class='row'>
    <div id='svg-turn'>
    </div>
    <div id='svg-heading'>
    </div>
    <div id='svg-vsi'>
   </div>
  </div>
</div>
<script src="/svg-ac-inst.js"></script>
<script>

// instantiate the heading indicator
var heading = svg_ac_inst.Heading(document.querySelector("#svg-heading"),"gg145-heading",true);
var degrees = 0;
var dhdg = 1.0;

// instantiate the altimeter, give it the name that matches the template
var altimeter = svg_ac_inst.Altimeter(document.querySelector("#svg-altimeter"),"gg145-altimeter",true);
var altitude=0.0;
var dalt = 1.0;
var pressure = 29.92;
altimeter.setPressure(pressure);

// instantiate the airspeed indicator, give it the name that matches the template
var airspeed_options =
{
  range  : 220,        // range index, 1 = 220
  green  :[80,140],  // green arc from clean stall to max cruise
  yellow :[140,160], // yellow arc from max cruise to never-exceed
  red    :160, // red arc from never-exceed to never-exceed
  white  :[50,100]   // white arc for stall-flaps to max-flaps
};

var airspeed = svg_ac_inst.Airspeed(document.querySelector("#svg-airspeed"),"gg145-airspeed",true,airspeed_options);
var speed = 0;
var dspd  = 1.0;

// instantiate the VSI, give it the name that matches the template
var vsi = svg_ac_inst.VSI(document.querySelector("#svg-vsi"),"gg145-vsi",true);
var vspeed = -2000;
var dv = 1.0;

// instantiate the attitude indicator, give it the name that matches the template
var attitude = svg_ac_inst.Attitude(document.querySelector('#svg-attitude'),"gg145-attitude",true);
var pitch = 0.0;
var roll = 0.0;
var dp = 0.1;
var dr = 0.1;

//  instantiate the turn coordinator, give it the name that matches the template
var turn = svg_ac_inst.Turn(document.querySelector('#svg-turn'),"gg145-turn",true);
var turn_rate=-3.0;
var db=0.1;
var accel = 0.0;

// simple resize that uses window size minus some border
function panel_onResize() {
    var cw = window.innerWidth  - 20;
    var ch = window.innerHeight - 20;
    var w = cw  / 3;
    var h = ch / 2;
    // use smaller of h and w so all 6 instruments will fit on the screen
    var s = (h < w) ? h : w;
    heading.resize(s);
    altimeter.resize(s);
    airspeed.resize(s);
    vsi.resize(s);
    attitude.resize(s);
    turn.resize(s);
}

function panel_onReady() {
    panel_onResize();

}

function run(timestamp) {
    airspeed.set(speed);
    altimeter.set(altitude);
    vsi.set(vspeed);
    turn.set(turn_rate,accel);
    attitude.set(pitch,roll);
    heading.set(degrees);

    pitch += dp;
    if (Math.abs(pitch)>45.0) {
        dp *= -1;
    }

    roll += dr;
    if (Math.abs(roll) >30.0) {
        dr *= -1;
    }

    vspeed+=dv;
    if (Math.abs(vspeed) >= 2000) {
      dv *= -1;
    }

    turn_rate += db;
    if (Math.abs(turn_rate) >= 3.0) {
      db *= -1.0;
    }

    degrees+=dhdg;
    if (Math.abs(degrees) > 360.0) {
        dhdg *= -1.0;
    }

    altitude+=dalt;

    speed += dspd;
    if (speed >= 220.0) {
        dspd *= -1.0;
    }
    if (speed <= 0.0) {
        dspd *= -1.0;
    }

    requestAnimationFrame(run);
  }

// add event listeners
window.addEventListener('resize',panel_onResize);
window.addEventListener('load',panel_onReady);

// start gauges running
requestAnimationFrame(run);

</script>
</body>
</html>
